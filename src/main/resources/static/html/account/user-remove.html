<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>회원 탈퇴</title>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- 아이콘, 폰트, 스타일 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/account-css/style.css" />
    <link rel="stylesheet" href="/account-css/modal.css" />
    <link rel="stylesheet" href="/css/bar.css" />
</head>
<body>
<div class="wrapper">
    <div class="main">
        <main class="container">
            <h1>회원 탈퇴</h1>

            <section class="notice">
                <h2>탈퇴 전, 주의사항</h2>
                <ol class="notice-list">
                    <li>계정 탈퇴 시, 클라리오 서비스에서 모두 탈퇴됩니다.</li>
                    <li>탈퇴 시 계정과 관련된 모든 권한이 사라지며 복구할 수 없습니다.</li>
                    <li>작성한 콘텐츠(동영상, 게시글, 댓글 등)는 자동으로 삭제되지 않으며, 원하실 경우 탈퇴 이전에 삭제가 필요합니다.</li>
                    <li>탈퇴 후 동일한 이메일로 재가입은 가능하나, 기존 계정과 연동되지 않습니다.</li>
                    <li>탈퇴 시 소셜 계정 정보도 함께 삭제되어 해당 계정으로의 로그인도 불가능합니다.</li>
                    <li>비밀번호 입력 후 '회원 탈퇴'를 클릭하시면 위 내용에 동의하는 것으로 간주됩니다.</li>
                </ol>
            </section>

            <form id="deleteForm" class="form-group" onsubmit="return false;">
                <label for="password" class="sr-only">비밀번호</label>
                <input type="password"
                       id="password"
                       name="password"
                       placeholder="비밀번호"
                       required />

                <div id="error-message" style="color:red; margin-top: 8px;"></div>

                <!-- 확인 모달 -->
                <div id="confirmModal" class="modal">
                    <div class="modal-content">
                        <p>정말로 탈퇴하시겠습니까?<br>이 작업은 되돌릴 수 없습니다.</p>
                        <div class="btn-group">
                            <button type="button" class="btn btn-cancel" onclick="closeConfirmModal()">취소</button>
                            <button type="button" class="btn btn-quit" onclick="submitDelete()">확인</button>
                        </div>
                    </div>
                </div>

                <!-- 버튼 -->
                <div class="btn-group" style="margin-top: 24px;">
                    <button type="button" class="btn btn-quit" onclick="openConfirmModal()">회원 탈퇴</button>
                    <a href="/account/edit" class="btn btn-cancel">취소</a>
                </div>
            </form>
        </main>
    </div>
</div>

<!-- 모달 제어 -->
<script>
    function openConfirmModal() {
        document.getElementById("confirmModal").style.display = "flex";
    }

    function closeConfirmModal() {
        document.getElementById("confirmModal").style.display = "none";
    }

    async function submitDelete() {
        const password = document.getElementById("password").value;
        const errorMsg = document.getElementById("error-message");

        try {
            const response = await axios.post("/api/member/remove", null, {
                params: { password: password },
                headers: {
                    "Content-Type": "application/json"
                }
            });

            alert("계정이 비활성화되었습니다.");
            window.location.href = "/"; // 홈 또는 로그인 페이지로 이동
        } catch (error) {
            if (error.response && error.response.status === 401) {
                errorMsg.textContent = "비밀번호가 일치하지 않습니다.";
            } else {
                errorMsg.textContent = "오류가 발생했습니다. 다시 시도해주세요.";
            }
            closeConfirmModal();
        }
    }
</script>
</body>
</html>
