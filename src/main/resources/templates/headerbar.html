<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>헤더와 사이드바</title>
    <link rel="stylesheet" href="/account-css/style.css" />
    <link rel="stylesheet" href="/css/bar.css"/>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<!-- 사이드바 -->
<aside class="sidebar">
    <div class="logo">
        <img src="/img/ClarioLogoTextOnly.png" alt="CLARIO Logo">
    </div>
    <ul class="menu">
        <li><a class="nav-icon" href="/dashboard">🏠</a></li>
        <li><a class="nav-icon" href="/statistics">📈</a></li>
        <li><a class="nav-icon" href="/history">☰</a></li>
        <li><a class="nav-icon" href="/card">💳</a></li>
    </ul>
</aside>

<!-- 상단바 -->
<header class="topbar">
    <div class="topbar-center" id="currentDate">날짜 로딩 중…</div>

    <div class="topbar-right">
        <span class="user-name" id="userName">로그인 사용자</span>

        <!-- 로그아웃 -->
        <form action="/logout" method="post" id="logoutForm">
            <button type="button" class="logout-btn"
                    onclick="document.getElementById('logoutForm').submit();">로그아웃</button>
        </form>

        <!-- 프로필 사진 + 드롭다운 -->
        <div class="profile-container" onclick="this.classList.toggle('hover')">
            <button class="profile-btn" id="profileBtn">
                <!-- 프로필 이미지가 없으면 기본 아이콘 -->
                <i class="bi bi-person" id="defaultProfileIcon"></i>
                <img src="" alt="프로필" class="profile-img" id="profileImg" style="display:none;" />
            </button>
            <div class="profile-menu">
                <button type="button" class="profile-menu-item" onclick="location.href='/mydata/mybankandcardlist'">
                    자산 조회
                </button>
                <button type="button" class="profile-menu-item" onclick="openPwInputModal()">정보 수정</button>
            </div>
        </div>
    </div>
</header>

<!-- 모달 등 아래는 그대로 유지 -->

<!-- 모달 Fragment -->
<div id="modals">
    <!-- 비밀번호 입력 모달 -->
    <div id="pwInputModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('pwInputModal')">&times;</span>
            <h2 style="text-align:center;">비밀번호</h2>
            <div class="form-field" style="justify-content:center;">
                <input type="password" id="currentPassword" placeholder="Password" />
            </div>
            <div id="pwInputError" class="error-msg" style="display:none;">비밀번호가 올바르지 않습니다.</div>
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal('pwInputModal')">취소</button>
                <button class="btn" onclick="validatePassword()">확인</button>
            </div>
            <div style="text-align:center; margin-top:8px;">
                <button class="btn-cancel" style="background:none; color:#ccc; border:none; cursor: pointer" onclick="openEmailModalFromPwInput()">비밀번호 재설정</button>
            </div>
        </div>
    </div>

    <!-- 이메일 인증 모달 -->
    <div id="emailModal" class="modal" data-email="">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('emailModal')">&times;</span>
            <h2 style="text-align:center;">이메일 인증</h2>
            <div class="form-field"><input type="text" id="email" readonly /></div>
            <div class="btn-group">
                <button id="sendCodeBtn" class="btn" onclick="sendVerificationEmail()">인증</button>
                <div id="timer" style="margin-top: 10px; font-weight: bold;"></div>
            </div>
            <div class="form-field" style="margin-top:16px;">
                <input type="text" id="emailCode" placeholder="인증 코드 입력" />
            </div>
            <div id="emailError" class="error-msg" style="display:none;">인증에 실패했습니다.</div>
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal('emailModal')">취소</button>
                <button id="verifyBtn" class="btn" onclick="verifyEmailCode()">확인</button>
            </div>
        </div>
    </div>

    <!-- 비밀번호 재설정 모달 -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('resetModal')">&times;</span>
            <h2 style="text-align:center;">비밀번호 재설정</h2>
            <div class="form-field"><label>새 비밀번호</label><input type="password" id="newPassword" /></div>
            <div class="form-field"><label>비밀번호 확인</label><input type="password" id="confirmNewPassword" /></div>
            <div id="resetError" class="error-msg" style="display:none;">비밀번호가 일치하지 않습니다.</div>
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal('resetModal')">취소</button>
                <button class="btn" onclick="changePassword()">변경</button>
            </div>
        </div>
    </div>
</div>

<script src="/js/modal.js"></script>

<!-- 날짜 표시 스크립트 -->
<script>
    const today = new Date();
    const days = ['일', '월', '화', '수', '목', '금', '토'];

    const year    = today.getFullYear();
    const month   = String(today.getMonth() + 1).padStart(2, '0');
    const date    = String(today.getDate()).padStart(2, '0');
    const weekday = days[today.getDay()];

    const formatted = `${year}/${month}/${date} ${weekday}`;

    const el = document.getElementById('currentDate');
    if (el) {
        el.textContent = formatted;
    }
</script>

<!-- 사용자 정보 불러오기 -->
<script>
    axios.get('/account/api/userinfo')
        .then(response => {
            const data = response.data;
            const userNameEl = document.getElementById('userName');
            const profileImg = document.getElementById('profileImg');
            const defaultIcon = document.getElementById('defaultProfileIcon');

            if (data && data.name) {
                userNameEl.textContent = data.name + '님';
            } else {
                userNameEl.textContent = '로그인 사용자';
            }

            if (data && data.profile) {
                profileImg.src = data.profile;
                profileImg.style.display = 'inline-block';
                if (defaultIcon) defaultIcon.style.display = 'none';
            } else {
                profileImg.style.display = 'none';
                if (defaultIcon) defaultIcon.style.display = 'inline-block';
            }
        })
        .catch(error => {
            console.error('사용자 정보 로드 실패:', error);
        });
</script>

</body>
</html>
