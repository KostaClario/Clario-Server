<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>개인정보 수정</title>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- 아이콘 폰트 & 구글 폰트 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/bar.css}" />
    <link rel="stylesheet" th:href="@{/account-css/user-info-edit.css}" />
    <link rel="stylesheet" th:href="@{/account-css/style.css}" />
</head>
<body>


<div th:replace="~{headerside :: allModals}"></div>
<!-- 사이드바 삽입 -->
<aside th:replace="~{headerside :: sidebar}"></aside>


<!-- 상단바 삽입 (파라미터 넘기기) -->
<div th:replace="~{headerside :: header}"></div>
<main class="container">
    <section class="content">
        <div class="profile-icon" style="text-align:center; margin-bottom:24px;">
            <img th:if="${profile != null}" th:src="${profile}" alt="프로필" class="profile-img" />
            <i th:if="${profile == null}" class="bi bi-person"></i>
        </div>

        <!-- 타임리프 form -->
        <form th:action="@{/account/edit}" th:object="${updateForm}" method="post" class="form-edit">

            <!-- 이메일 (읽기 전용) -->
            <div class="form-field">
                <span th:text="*{email}"></span>
            </div>

            <!-- 이름 (수정 가능) -->
            <div class="form-field">
                <input type="text" th:field="*{name}" placeholder="이름" class="rounded-input" required />
            </div>

            <!-- 휴대폰 번호 (수정 가능, 숫자만) -->
            <div class="form-field">
                <input type="text" th:field="*{phonenum}" placeholder="휴대폰 번호"
                       class="phonenum-input rounded-input" maxlength="13" required />
            </div>

            <!-- 새 비밀번호 -->
            <div class="form-field" style="margin:12px 0 4px; text-align:center;">
                <input type="password" th:field="*{newPassword}"
                       placeholder="새 비밀번호 (영문·숫자·특수문자 8~16자)"
                       minlength="8" maxlength="16" class="rounded-input"/>
            </div>

            <!-- 비밀번호 확인 -->
            <div class="form-field" style="margin:12px 0 4px; text-align:center;">
                <input type="password" th:field="*{confirmPassword}" placeholder="새 비밀번호 확인"
                       class="rounded-input" id="confirmPassword"/>
                <div th:if="${error}" th:text="${error}" style="color:red;"></div>
            </div>

            <div class="form-field" style="margin:12px 0 4px; text-align:center;">
                <a th:href="@{/account/remove}" class="btn withdraw-btn" style="color: #ccc;">
                    회원탈퇴
                </a>
            </div>

            <!-- 버튼 -->
            <div class="btn-group" style="margin-top:32px; text-align:center;">
                <button type="button" class="btn btn-cancel" th:onclick="|window.location.href='@{/dashboard}'|">취소</button>
                <button type="submit" class="btn btn-quit">수정 완료</button>
            </div>
        </form>
    </section>
</main>

<!-- 클라이언트 측 비밀번호 일치 확인 -->
<script>
    const form = document.querySelector('.form-edit');
    form.addEventListener('submit', function (e) {
        const pw = form.querySelector('[name="newPassword"]').value;
        const confirm = form.querySelector('[name="confirmPassword"]').value;

        if (pw && pw !== confirm) {
            e.preventDefault();
            alert("비밀번호가 일치하지 않습니다.");
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        const phoneInput = document.querySelector('.phonenum-input');

        phoneInput.addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, ''); // 숫자만 남김

            if (value.length < 4) {
                e.target.value = value;
            } else if (value.length < 8) {
                e.target.value = value.replace(/(\d{3})(\d{1,4})/, '$1-$2');
            } else {
                e.target.value = value.replace(/(\d{3})(\d{4})(\d{0,4})/, '$1-$2-$3');
            }
        });
    });
</script>

<script th:src="@{/js/modal.js}"></script>

<script th:inline="javascript">
    const today = new Date();
    const days = ['일', '월', '화', '수', '목', '금', '토'];

    const year    = today.getFullYear();
    const month   = String(today.getMonth() + 1).padStart(2, '0');
    const date    = String(today.getDate()).padStart(2, '0');
    const weekday = days[today.getDay()];

    const formatted = `${year}. ${month}. ${date}. (${weekday})`;

    const el = document.getElementById('currentDate');
    if (el) {
        el.textContent = formatted;
    }
</script>
</body>
</html>
